import{aL as e,_ as a,d as s,bj as t,e as l,c as o,u as n,r as i,R as r,aQ as u,f as d,o as c,g as p,h as f,w as m,$ as v,aS as g,p as h,k as b,i as y,j,t as U}from"./index.d061a68e.js";import{N as w,a as x,H as B,u as F}from"./HelpButton.baea5046.js";import{N as I,u as N}from"./Upload.e117e3cf.js";import{u as L}from"./use-notification.41a48f00.js";import"./Add.97a551e1.js";const S=s({components:{NUpload:I,NDivider:w,NModal:t,NButton:l,NSpin:x,HelpButton:B},setup(){const a=g+"/upload/album",s=o(!1),t=o("保存设置"),l=N(),d=L(),c=n(),p=o(""),f=i({userId:""}),m=i({Authorization:localStorage.getItem("token")}),v=o([]);r((async()=>{f.userId=c.state.user.userid;let a=await function(a){return e({url:"/getinfo/8",method:"post",data:a})}({userId:c.state.user.userid});if(console.log(a),a.data){let e=a.data.fileArr;for(let a of e)v.value.push(a);t.value="修改设置"}else t.value="保存设置";s.value=!1})),u((async()=>{let a=await(s={userId:c.state.user.userid},e({url:"/delfile/album",method:"post",data:s}));var s;console.log(a)}));const{saveSetting:h}=F(),b=async()=>{let a=null,s=v.value.map((e=>e.name)),l=v.value;var o,n,i;"保存设置"==t.value?(a=await(o={userId:c.state.user.userid,fileList:s},e({url:"/createinfo/8",method:"post",data:o})),t.value="修改设置"):"修改设置"==t.value&&(console.log(l),a=await function(a){return e({url:"/updateinfo/8",method:"post",data:a})}({userId:c.state.user.userid,fileList:l})),console.log(a),200==a.status&&(n="success",i=a.message,d[n]({content:i,duration:1500}))};return{loading:s,btnText:t,FileList:v,handleFinish:({file:e,event:a})=>{const s=(null==a?void 0:a.target).response,t=JSON.parse(s);if(console.log(t),200==t.status){l.success(t.message);const a={id:e.id,name:t.data,status:"finished"};v.value.push(a)}else l.error(t.message);return console.log(e),e},beforeUpload:e=>{var a;return(null==(a=e.file.file)?void 0:a.size)>=512e3?(l.error("限制图片大小为500KB以内，请重新上传"),!1):(p.value=c.state.user.userid+"-"+e.file.name,!v.value.some((e=>e.name==p.value))||(l.error("该文件已经上传, 请勿重新上传"),!1))},saveContent:async()=>{s.value=!0,await h(b),s.value=!1},apiBaseUrlUploadAlbum:a,uploadData:f,removeFile:async({file:e,fileList:a})=>{const s=e.name;console.log(s),v.value=v.value.filter((e=>e.name!=s)),console.log(v.value)},headers:m,distance:o(30)}}}),_=e=>(h("data-v-6cc03041"),e=e(),b(),e),A=_((()=>y("h2",null,"第八页 - 我们的相册",-1))),k=_((()=>y("h4",null,"从相册中获取前六张图片,放置此页面",-1))),C={class:"container"};var z=a(S,[["render",function(e,a,s,t,l,o){const n=d("n-divider"),i=d("n-upload"),r=d("help-button"),u=d("n-button"),g=d("n-space"),h=d("n-spin");return c(),p(v,null,[A,k,f(h,{size:"large",show:e.loading},{default:m((()=>[y("div",C,[f(n),f(i,{action:e.apiBaseUrlUploadAlbum,headers:e.headers,data:e.uploadData,"default-file-list":e.FileList,"list-type":"image-card",max:"15",accept:".jpg,.jpeg,.png",onFinish:e.handleFinish,onBeforeUpload:e.beforeUpload,onRemove:e.removeFile},null,8,["action","headers","data","default-file-list","onFinish","onBeforeUpload","onRemove"]),f(g,{style:{"margin-top":"20px"},justify:"center"},{default:m((()=>[f(r,{picSrc:"https://tva1.sinaimg.cn/large/e6c9d24ely1h2bvp0s912j213y0lvjuh.jpg",place:"bottom-start",heightValue:"395",widthValue:"600"}),f(u,{style:{margin:"30px 0 0 20px"},strong:"",secondary:"",type:"primary",onClick:e.saveContent},{default:m((()=>[j(U(e.btnText),1)])),_:1},8,["onClick"])])),_:1})])])),_:1},8,["show"])],64)}],["__scopeId","data-v-6cc03041"]]);export{z as default};
